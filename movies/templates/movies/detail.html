{% extends 'base.html' %}
{% load bootstrap4 %}

{% block title %}DETAIL OF {{ movie.title }}{% endblock title %}

{% block style %}
<style>
  #utube {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%;
  }

  #utube #contentFrame {
    position: absolute;
    width: 100%;
    height: 100%;
  }
</style>
{% endblock style %}

{% block content %}
<h1 class="d-inline">{{ movie.title }} <small>({{ movie.year }})</small></h1>
{% if user.is_superuser  %}
<a href="{% url 'movies:update' movie.pk %}" class="btn btn-primary d-inline">영화 정보 수정</a>
<form action="" method="POST">
  {% csrf_token %}
</form>
{% endif %}
<hr>

<div class="container">
  <div class="row">
    <div class="col-sm poster text-center mb-3">
      <img src="{{ movie.poster_path }}" class="img-fluid" alt="{{ movie.title }}">
    </div>

    <div class="col-sm jumbotron bg-white">
      <div class="grade">
        <h5>{{ movie.grade }}</h5>
        <hr>
      </div>
      <h4>개요</h4>
      <p class="lead">{{ movie.description }}</p>
      <hr class="my-4">
      <div class="row">
        <div class="col-6 genre">
          <h5>장르</h5>
          <p>{{ movie.genre }}</p>
        </div>
        .col-6 
      </div>
    </div>
    <div id="utube" class="mx-auto">
      <iframe src="{{ movie.youtube_url }}" id="contentFrame" scrolling="no"
        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      <script>
        function init() {
          const doc = document.getElementById('utube');
          if (doc.offsetHeight == 0) {} else {
            pageheight = doc.offsetHeight
            parent.document.getElementById("contentFrame").height = pageheight + "px"
          }
        }
        window.onload = function () {
          init()
        }
      </script>
    </div>
  </div>

</div>

<hr>
<!-- 리뷰 보이는 곳 -->
<div class="mx-auto">
<hr>
{% for rating in ratings %}
<div class="list-group">
  {% if not user.is_authenticated %}
  <div class="list-group-item list-group-item-action"
      value="작성: {{ rating.user }} || {{ rating.comment }} || 평점: {{ rating.score }}"></div>
  {% else %}
  <form action="{% url 'movies:rating_delete' movie.pk rating.pk %}" method="POST">
    {% csrf_token %}
    {% if request.user == rating.user %}
     <input type="submit" class="list-group-item list-group-item-action"
       value="작성: {{ rating.user }} || {{ rating.comment }} || 평점: {{ rating.score }}"> <i class="btn btn-outline-white far fa-trash-alt"></i>
    {% else %}
     <input type="submit" class="list-group-item list-group-item-action"
      value="작성: {{ rating.user }} || {{ rating.comment }} || 평점: {{ rating.score }}">
    {% endif %}
  </form>
  {% endif %}
</div>
{% empty %}
<p><b>입력된 리뷰가 없습니다.</b></p>
{% endfor %}
<hr>
<!-- 댓글 작성 공간(form) -->
{% if user.is_authenticated  %}
<form action="{% url 'movies:rating_create' movie.pk %}" method="POST">
  {% csrf_token %}
  {% bootstrap_form rating_form %}
  <input class="btn btn-secondary" type="submit" value="리뷰 추가">
</form>
<hr>
{% else %}
<a class="btn btn-warning" href="{% url 'accounts:login' %}">리뷰를 작성하려면 로그인하세요.</a>
<hr>
{% endif %}
<a class="btn btn-primary" href="{% url 'movies:index' %}">BACK</a>
</div>
{% endblock  %}